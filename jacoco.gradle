apply plugin: "jacoco"

test {
    finalizedBy jacocoTestReport // report is always generated after tests run
    finalizedBy jacocoTestCoverageVerification
}

jacocoTestReport {
    dependsOn test // tests are required to run before generating the report
}

jacocoTestReport {
    reports {
        xml.required = false
        csv.required = false
        html.outputLocation = layout.buildDirectory.dir('jacocoHtml')
    }
}

jacocoTestCoverageVerification {
    dependsOn test
    violationRules {
        rule {
            limit {
                minimum = 0.9
            }
        }
    }
}

test.jacoco.enabled = true

test {
    jacoco {
        enabled = true
        includes = [
                "ru/vorobeij/**/*.kt",
                "ru.vorobeij.*"
        ]
        excludes = [
                "**/data/*"
        ]
    }
}